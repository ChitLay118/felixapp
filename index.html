<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wai App Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Styles for Play Store feel */
        .shadow-play { box-shadow: 0 1px 3px 0 rgba(60,64,67,.3), 0 4px 8px 3px rgba(60,64,67,.15); }
        .bg-f0f2f5 { background-color: #f0f2f5; }
        .text-play-green { color: #008060; }
        .bg-play-green { background-color: #008060; }
        .hover\:bg-active-blue-dark:hover { background-color: #005A9C; }
        .text-active-blue { color: #1a73e8; }
        .nav-category-btn.active { color: #1a73e8; font-weight: bold; border-top: 2px solid #1a73e8; margin-top: -2px; }
    </style>
</head>
<body class="bg-f0f2f5 pb-20">

    <script type="module">
        // --------------------------------------------------------------------------------
        // 1. FIREBASE INITIALIZATION AND IMPORTS
        // --------------------------------------------------------------------------------

        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
        import { 
            getFirestore, doc, updateDoc, deleteDoc, 
            collection, query, orderBy, onSnapshot, addDoc, serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
        import { 
            getAuth, onAuthStateChanged, 
            signInAnonymously // Guest Login အတွက်
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";


        // Your web app's Firebase configuration - (သင့်ရဲ့ ကိုယ်ပိုင် Firebase Config ကို အစားထိုးထည့်သွင်းပါ)
        const firebaseConfig = {
            apiKey: "AIzaSyAUL74mqVCIY1MMclrRhdVbY_VyP4lgQpY", 
            authDomain: "waiappstore.firebaseapp.com",
            projectId: "waiappstore",
            storageBucket: "waiappstore.firebasestorage.app",
            messagingSenderId: "161610339691",
            appId: "1:161610339691:web:5f8e9fcd9706fda330682e",
            measurementId: "G-T3NWL0LXTT"
        };

        // Initialize Firebase services
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        // Initialize Database and Authentication for use in the app
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Global variables and constants
        let currentEditAppId = null; 
        const APP_COLLECTION_PATH = 'apps';
        
        // ADMIN CREDENTIALS (သင်သတ်မှတ်ထားသည့်အတိုင်း)
        const ADMIN_NAME = 'felix'; 
        const ADMIN_PASSWORD = '118234'; 
        
        // Custom User Info Management (Email/Password မသုံးတော့ဘဲ Name/Email ကို ဤနေရာတွင် သိမ်းပါမည်)
        let customUserData = {
            name: 'ဧည့်သည်',
            email: 'guest@appstore.com',
            isLoggedIn: false
        };

        // Exporting to window for easy access
        window.db = db;
        window.auth = auth;
        window.allApps = [];
        window.isAdmin = false;
        
        // Get elements from the DOM
        const editAppForm = document.getElementById('editAppForm');
        const submitAppModal = document.getElementById('submitAppModal');
        const profileModal = document.getElementById('profileModal');
        const editAppModal = document.getElementById('editAppModal');
        const userDisplayBtn = document.getElementById('userDisplayBtn');
        const submitAppForm = document.getElementById('appSubmissionForm');
        const appListContainer = document.getElementById('appListContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const viewTitle = document.getElementById('viewTitle');
        const noResults = document.getElementById('noResults');
        const loginContainer = document.getElementById('loginContainer'); 
        const logoutContainer = document.getElementById('logoutContainer'); 
        const adminLoginContainer = document.getElementById('adminLoginContainer'); 
        const userLoginModal = document.getElementById('userLoginModal'); 
        const userLoginForm = document.getElementById('userLoginForm'); 

        // --------------------------------------------------------------------------------
        // 2. CUSTOM AUTHENTICATION FUNCTIONS (Name/Email Login)
        // --------------------------------------------------------------------------------
        
        // Anonymous Login (Firebase အတွက်) ကို အသုံးပြု၍ UID ရယူထားမည်
        window.initAuth = async () => {
            if (!auth.currentUser) {
                try {
                    await signInAnonymously(auth);
                } catch (error) {
                    console.error("Anonymous Sign-in Error: ", error);
                }
            }
        }
        
        // Custom Login (Name/Email ဖြင့်)
        window.userLogin = () => {
            const nameInput = document.getElementById('loginNameInput').value.trim();
            const emailInput = document.getElementById('loginEmailInput').value.trim();

            if (!nameInput || !emailInput) {
                window.showToast("နာမည်နှင့် Email လိပ်စာကို ဖြည့်သွင်းပါ။", 'error');
                return;
            }
            
            // Guest mode မှ Name/Email mode သို့ ပြောင်းလဲခြင်း
            customUserData.name = nameInput;
            customUserData.email = emailInput;
            customUserData.isLoggedIn = true;
            
            userLoginModal.classList.add('hidden');
            window.showToast("Login အောင်မြင်ပါသည်။", 'success');
            window.updateProfileUI(); 
        };
        
        // Custom Logout
        window.userLogout = () => {
            // Firebase Anonymous User ကို မဖျက်ဘဲ custom data ကို reset လုပ်သည်
            customUserData.name = 'ဧည့်သည်';
            customUserData.email = 'guest@appstore.com';
            customUserData.isLoggedIn = false;
            
            window.showToast("အောင်မြင်စွာ ထွက်ပြီးပါပြီ။", 'info');
            profileModal.classList.add('hidden');
            window.updateProfileUI(); 
        };
        
        // Custom Admin Login
        window.adminLogin = () => {
            const adminName = document.getElementById('adminNameInput').value.trim();
            const adminPass = document.getElementById('adminPassInput').value.trim();

            if (adminName === ADMIN_NAME && adminPass === ADMIN_PASSWORD) {
                window.isAdmin = true;
                document.getElementById('adminNameInput').value = '';
                document.getElementById('adminPassInput').value = '';
                window.showToast("Admin Login အောင်မြင်ပါသည်။", 'success');
                window.updateProfileUI();
            } else {
                window.showToast("Admin Name သို့မဟုတ် Password မှားနေပါသည်။", 'error');
            }
        };

        // Custom Admin Logout
        window.adminLogout = () => {
            window.isAdmin = false;
            window.showToast("Admin ထွက်ပြီးပါပြီ။", 'info');
            window.updateProfileUI();
        };


        // --------------------------------------------------------------------------------
        // 3. CORE APPLICATION LOGIC (UI/Data)
        // --------------------------------------------------------------------------------
        
        // ... (window.filterApps, window.setView, window.setCategoryFilter, window.renderApps, window.openEditModal, window.handleAppClick functions are the same as before) ...
        
        // Placeholder for filtering logic
        window.filterApps = () => {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const currentCategory = window.currentCategoryFilter || 'All';
            const currentView = window.currentView || 'all';

            let filtered = window.allApps;
            
            // 1. Filter by View (All or Mine)
            if (currentView === 'mine' && customUserData.isLoggedIn) {
                // Custom User Login ဖြင့် UID ကို အသုံးပြု၍ စစ်ထုတ်သည်
                const userUid = auth.currentUser ? auth.currentUser.uid : 'N/A';
                filtered = filtered.filter(app => app.submitterId === userUid && app.submitterEmail === customUserData.email);
            }

            // 2. Filter by Category
            if (currentCategory !== 'All') {
                filtered = filtered.filter(app => app.category === currentCategory);
            }

            // 3. Filter by Search Term
            if (searchTerm) {
                filtered = filtered.filter(app => 
                    app.name.toLowerCase().includes(searchTerm) || 
                    app.description.toLowerCase().includes(searchTerm)
                );
            }

            window.renderApps(filtered);
            
            if (filtered.length === 0 && (searchTerm || currentCategory !== 'All' || currentView === 'mine')) {
                noResults.classList.remove('hidden');
                document.getElementById('noResultsText').textContent = searchTerm 
                    ? `"${searchTerm}" အတွက် ရလဒ် မတွေ့ရှိပါ။` 
                    : "ရှာဖွေမှုရလဒ် မတွေ့ရှိပါ။";
            } else {
                noResults.classList.add('hidden');
            }
        };
        
        // Sets the view (All, Mine) and triggers filter
        window.setView = (view) => {
            window.currentView = view;
            
            document.getElementById('closeProfileModalBtn').addEventListener('click', () => {
                profileModal.classList.add('hidden');
                if (window.currentView === 'mine') {
                    window.setView('all'); 
                }
            });
            
            if (view === 'mine') {
                if (!customUserData.isLoggedIn) {
                    window.showToast("App တင်သွင်းမှုများကိုကြည့်ရန် Name/Email ဖြင့် ဝင်ရန် လိုအပ်ပါသည်။", 'error');
                    window.setView('all');
                    return;
                }
                viewTitle.textContent = "ကျွန်ုပ်တင်ထားသော App များ";
                document.getElementById('backToAllContainer').innerHTML = 
                    `<button onclick="window.setView('all')" class="text-sm font-medium text-active-blue hover:text-blue-700 transition">
                        <i data-lucide="arrow-left" class="w-4 h-4 inline mr-1"></i> App အားလုံးသို့ ပြန်သွားရန်
                    </button>`;
            } else {
                viewTitle.textContent = "အသစ်ဆုံး App များအားလုံး";
                document.getElementById('backToAllContainer').innerHTML = '';
            }
            lucide.createIcons(); 
            window.filterApps();
        };

        // Sets category filter and triggers app filter
        window.setCategoryFilter = (category, shouldFilter = true) => {
            window.currentCategoryFilter = category;
            
            document.querySelectorAll('.nav-category-btn').forEach(btn => {
                btn.classList.remove('active', 'text-active-blue');
                btn.classList.add('text-gray-500');
            });
            const activeBtn = document.getElementById(`nav-${category}`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'text-active-blue');
                activeBtn.classList.remove('text-gray-500');
            }

            if (shouldFilter) {
                window.filterApps();
            }
        };

        // Renders the app cards to the DOM
        window.renderApps = (apps) => {
            appListContainer.innerHTML = apps.map(app => `
                <div class="app-card bg-white p-4 rounded-xl shadow-play hover:shadow-lg transition cursor-pointer" onclick="window.handleAppClick('${app.id}', '${app.mediaFireLink}')">
                    <img src="${app.iconUrl}" alt="${app.name} icon" class="w-16 h-16 rounded-xl mx-auto mb-3 object-cover">
                    <p class="text-sm font-bold text-gray-800 truncate text-center">${app.name}</p>
                    <p class="text-xs text-gray-500 text-center">${app.category}</p>
                    ${window.isAdmin ? `
                        <div class="mt-2 text-center">
                            <button onclick="event.stopPropagation(); window.openEditModal('${app.id}')" 
                                class="text-xs text-yellow-600 hover:text-yellow-700 font-semibold">
                                Edit
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');

            loadingIndicator.classList.add('hidden');
        };

        // Opens the edit modal for Admin
        window.openEditModal = (appId) => {
            if (!window.isAdmin) return;
            const appToEdit = window.allApps.find(app => app.id === appId);
            if (!appToEdit) return;

            currentEditAppId = appId;

            document.getElementById('editAppName').value = appToEdit.name || '';
            document.getElementById('editAppDescription').value = appToEdit.description || '';
            document.getElementById('editAppCategory').value = appToEdit.category || 'Games';
            document.getElementById('editMediaFireLink').value = appToEdit.mediaFireLink || '';
            document.getElementById('editIconUrl').value = appToEdit.iconUrl || '';
            
            document.getElementById('deleteAppNameToConfirm').textContent = appToEdit.name;

            document.getElementById('editAppModal').classList.remove('hidden');
        };

        // Handles app card click (Download)
        window.handleAppClick = (appId, link) => {
            if (link) {
                window.open(link, '_blank');
            } else {
                window.showToast("ဒေါင်းလုတ်လင့်ခ် မတွေ့ပါ။", 'error');
            }
        };


        // Updates all UI elements related to the current user/auth status
        window.updateProfileUI = () => {
            // UI elements
            const profileAvatarInitials = document.getElementById('profileAvatarInitials');
            const profileDisplayName = document.getElementById('profileDisplayName');
            const profileDisplayEmail = document.getElementById('profileDisplayEmail');
            const currentUserIdSpan = document.getElementById('currentUserIdSpan');
            const submitterNameInput = document.getElementById('submitterNameInput');
            const submitterEmailInput = document.getElementById('submitterEmailInput');
            
            const adminPanelStatus = document.getElementById('adminPanelStatus');
            const adminLoginSection = document.getElementById('adminLoginSection');
            const adminLogoutSection = document.getElementById('adminLogoutSection');
            
            const user = auth.currentUser; // Firebase Anonymous User

            // --- ADMIN UI UPDATE ---
            if (window.isAdmin) {
                adminPanelStatus.classList.remove('hidden');
                adminLoginSection.classList.add('hidden');
                adminLogoutSection.classList.remove('hidden');
            } else {
                adminPanelStatus.classList.add('hidden');
                adminLoginSection.classList.remove('hidden');
                adminLogoutSection.classList.add('hidden');
            }
            
            // --- USER UI UPDATE ---
            if (customUserData.isLoggedIn) {
                // Custom User Logged In 
                
                // Profile Modal Display
                profileDisplayName.textContent = customUserData.name;
                profileDisplayEmail.textContent = customUserData.email;
                profileAvatarInitials.textContent = customUserData.name.charAt(0).toUpperCase();
                currentUserIdSpan.textContent = user ? user.uid : 'N/A';

                // Submission Modal Input
                submitterNameInput.value = customUserData.name;
                submitterEmailInput.value = customUserData.email;

                // Header Button Display
                userDisplayBtn.textContent = customUserData.name.charAt(0).toUpperCase();
                
                loginContainer.classList.add('hidden');    
                logoutContainer.classList.remove('hidden'); 

            } else {
                // User Logged Out (Guest)
                profileDisplayName.textContent = 'ဧည့်သည်';
                profileDisplayEmail.textContent = 'Name/Email ဖြင့် ဝင်ရောက်ပါ';
                profileAvatarInitials.textContent = 'G';
                currentUserIdSpan.textContent = user ? user.uid : 'N/A';
                
                userDisplayBtn.textContent = '?';
                submitterNameInput.value = 'ဧည့်သည်';
                submitterEmailInput.value = 'guest@appstore.com';
                
                loginContainer.classList.remove('hidden'); 
                logoutContainer.classList.add('hidden'); 
            }
        };

        // --- 4. FIREBASE LISTENERS ---

        // Real-time listener for the apps collection
        const appQuery = query(collection(db, APP_COLLECTION_PATH), orderBy("timestamp", "desc"));

        onSnapshot(appQuery, (snapshot) => {
            window.allApps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            window.filterApps(); 
            loadingIndicator.classList.add('hidden');
        }, (error) => {
            console.error("Error fetching documents: ", error);
            window.showToast("App အချက်အလက်များကို ဆွဲယူရာတွင် အမှားဖြစ်ခဲ့သည်။", 'error');
            loadingIndicator.classList.add('hidden');
        });

        // Real-time listener for Auth State (Anonymous User ၏ UID ရယူရန်)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.currentUser = user;
            } else {
                window.currentUser = null;
            }
            window.updateProfileUI(); 
            window.filterApps();
        });

        // --- 5. FORM SUBMISSION LOGIC (Create/Update/Delete) ---

        // User: Submit New App Logic
        submitAppForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!customUserData.isLoggedIn || !auth.currentUser || !db) {
                window.showToast("App တင်သွင်းရန်အတွက် Name/Email ဖြင့် ဝင်ရန် လိုအပ်ပါသည်။", 'error');
                return;
            }

            const name = document.getElementById('appName').value.trim();
            const description = document.getElementById('appDescription').value.trim();
            const category = document.getElementById('appCategory').value;
            const mediaFireLink = document.getElementById('mediaFireLink').value.trim();
            const iconUrl = document.getElementById('iconUrl').value.trim();
            
            if (!name || !description || !mediaFireLink || !iconUrl) {
                window.showToast("ကျေးဇူးပြု၍ လိုအပ်သောအချက်အလက်အားလုံးကို ဖြည့်သွင်းပါ။", 'error');
                return;
            }
            
            const submitterName = customUserData.name;
            const submitterEmail = customUserData.email;
            const submitterId = auth.currentUser.uid; // Anonymous UID ကို သုံးသည်

            try {
                await addDoc(collection(db, APP_COLLECTION_PATH), {
                    name,
                    description,
                    category,
                    mediaFireLink,
                    iconUrl,
                    submitterName,
                    submitterEmail, // Custom Email ကို ထည့်သွင်းသိမ်းဆည်း
                    submitterId,
                    timestamp: serverTimestamp() 
                });

                window.showToast(`"${name}" App တင်သွင်းခြင်း အောင်မြင်ပါသည်။`, 'success');
                submitAppForm.reset();
                submitAppModal.classList.add('hidden');
            } catch (error) {
                console.error("Error submitting app: ", error);
                window.showToast("App တင်သွင်းရာတွင် အမှားဖြစ်ခဲ့သည်။", 'error');
            }
        });

        // Admin: Update App Logic
        editAppForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentEditAppId || !window.isAdmin || !db) return;
            // ... (Update Logic is the same) ...
            
            const name = document.getElementById('editAppName').value.trim();
            const description = document.getElementById('editAppDescription').value.trim();
            const category = document.getElementById('editAppCategory').value;
            const mediaFireLink = document.getElementById('editMediaFireLink').value.trim();
            const iconUrl = document.getElementById('editIconUrl').value.trim();
            
            if (!name || !description || !mediaFireLink || !iconUrl) {
                window.showToast("ကျေးဇူးပြု၍ လိုအပ်သောအချက်အလက်အားလုံးကို ဖြည့်သွင်းပါ။", 'error');
                return;
            }
            
            const appRef = doc(db, APP_COLLECTION_PATH, currentEditAppId);
            try {
                await updateDoc(appRef, {
                    name,
                    description,
                    category,
                    mediaFireLink,
                    iconUrl,
                });

                window.showToast(`"${name}" App အချက်အလက်များကို ပြင်ဆင်ပြီးပါပြီ။`, 'success');
                document.getElementById('editAppModal').classList.add('hidden');
                currentEditAppId = null;
            } catch (error) {
                console.error("Error updating app: ", error);
                window.showToast("App ပြင်ဆင်ရာတွင် အမှားဖြစ်ခဲ့သည်။", 'error');
            }
        });
        
        // Admin: Delete App Confirmation Logic
        window.confirmAndDelete = async function() {
            const appNameInput = document.getElementById('deleteConfirmationInput').value.trim();
            if (!currentEditAppId || !window.isAdmin || !db) return;
            // ... (Delete Logic is the same) ...
            
            const appToEdit = window.allApps.find(app => app.id === currentEditAppId);
            
            if (appNameInput === appToEdit.name) {
                const appRef = doc(db, APP_COLLECTION_PATH, currentEditAppId);
                try {
                    await deleteDoc(appRef);
                    window.showToast(`"${appToEdit.name}" App ဖျက်ခြင်း အောင်မြင်ပါသည်။`, 'success');
                    document.getElementById('editAppModal').classList.add('hidden');
                    currentEditAppId = null;
                    document.getElementById('deleteConfirmationInput').value = '';
                } catch (error) {
                    console.error("Error deleting app: ", error);
                    window.showToast("App ဖျက်ရာတွင် အမှားဖြစ်ခဲ့သည်။", 'error');
                }
            } else {
                window.showToast("App နာမည် မှန်ကန်စွာ ရိုက်ထည့်ပေးပါ။", 'error');
            }
        }
        
        // --- 6. MODAL AND UTILITY FUNCTIONS ---

        // Modal Toggling (Open)
        document.getElementById('submitAppBtn').addEventListener('click', () => {
            window.updateProfileUI(); 
            if (!customUserData.isLoggedIn) {
                window.showToast("App တင်သွင်းရန်အတွက် Name/Email ဖြင့် ဝင်ရန် လိုအပ်ပါသည်။", 'error');
                return;
            }
            submitAppModal.classList.remove('hidden');
        });

        // ... (Modal Close functions are the same) ...
        // Modal Toggling (Close)
        document.getElementById('closeModalBtn').addEventListener('click', () => { submitAppModal.classList.add('hidden'); });
        document.getElementById('closeProfileModalBtn').addEventListener('click', () => { 
            profileModal.classList.add('hidden'); 
            if (window.currentView === 'mine') {
                window.setView('all'); 
            }
        });
        document.getElementById('closeEditModalBtn').addEventListener('click', () => {
            editAppModal.classList.add('hidden');
            currentEditAppId = null;
        });
        document.getElementById('closeUserLoginModalBtn').addEventListener('click', () => { userLoginModal.classList.add('hidden'); });
        
        // Outside click to close (အရင်အတိုင်း)
        submitAppModal.addEventListener('click', (e) => { if (e.target === submitAppModal) submitAppModal.classList.add('hidden'); });
        profileModal.addEventListener('click', (e) => { if (e.target === profileModal) profileModal.classList.add('hidden'); });
        editAppModal.addEventListener('click', (e) => { if (e.target === editAppModal) { editAppModal.classList.add('hidden'); currentEditAppId = null; } });
        userLoginModal.addEventListener('click', (e) => { if (e.target === userLoginModal) userLoginModal.classList.add('hidden'); });


        // Open Profile Modal 
        userDisplayBtn.addEventListener('click', () => {
            window.updateProfileUI(); 
            profileModal.classList.remove('hidden');
        });

        // Toast Notification 
        window.showToast = function(message, type = 'info') {
            const toast = document.getElementById('toastNotification');
            toast.textContent = message;
            toast.className = 'fixed bottom-4 right-4 p-4 rounded-lg shadow-xl text-white transition-opacity duration-300 z-50';

            if (type === 'success') {
                toast.classList.add('bg-green-600');
            } else if (type === 'error') {
                toast.classList.add('bg-red-600');
            } else {
                toast.classList.add('bg-blue-600');
            }

            toast.classList.remove('opacity-0', 'hidden');
            toast.classList.add('opacity-100');

            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
            }, 3000);
        }

        // Initial setup on window load
        window.onload = () => {
            window.initAuth(); // Firebase Anonymous Login ကို အရင်လုပ်ထားမည်
            lucide.createIcons(); 
            window.setView('all'); 
            window.setCategoryFilter('All', false); 
            document.getElementById('searchInput').oninput = window.filterApps;
        };
        
    </script>
    
    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <header class="sticky top-0 z-30 bg-f0f2f5 pt-2 pb-4">
            <div class="flex items-center space-x-3 bg-white p-2 rounded-full shadow-play w-full max-w-7xl mx-auto border-t-2 border-play-green">
                
                <button onclick="window.setView('all')" class="flex items-center text-play-green hover:text-active-blue transition duration-150" title="App အားလုံး View ကို ပြန်သွားရန်">
                    <i data-lucide="play-circle" class="w-6 h-6 ml-2 fill-play-green/10"></i>
                </button>
                

                <input type="text" id="searchInput" placeholder="App များကို ရှာဖွေပါ..."
                         class="flex-grow p-1 text-gray-700 placeholder-gray-400 bg-transparent focus:outline-none"
                         oninput="filterApps()">

                <button id="submitAppBtn" 
                            class="flex items-center justify-center p-2 rounded-full bg-play-green text-white hover:bg-active-blue-dark active:bg-blue-700 transition duration-150 shadow-md"
                            title="App အသစ် တင်သွင်းရန်">
                    <i data-lucide="upload-cloud" class="w-5 h-5"></i>
                </button>
                
                <button id="userDisplayBtn" 
                            class="flex items-center justify-center w-9 h-9 rounded-full bg-play-green text-white font-bold text-xs shadow-md ring-2 ring-play-green/50 hover:ring-active-blue transition duration-150"
                            title="Profile ကို ဖွင့်ရန်">
                    </button>
            </div>
        </header>

<main class="mt-4">
            <div class="flex items-center justify-between mb-6 border-b-2 border-active-blue pb-2">
                <h2 id="viewTitle" class="text-xl font-bold text-gray-800">
                    အသစ်ဆုံး App များအားလုံး
                </h2>
                <div id="backToAllContainer"></div> 
            </div>
            
            <div id="loadingIndicator" class="text-center p-10 bg-white rounded-xl shadow-play">
                <div class="flex items-center justify-center space-x-2">
                    <div class="w-6 h-6 border-4 border-blue-300 border-t-blue-600 rounded-full animate-spin"></div>
                    <p class="text-blue-600 font-medium">အက်ပ်များကို ဆွဲယူနေပါသည်...</p>
                </div>
            </div>

            <div id="appListContainer" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
                </div>

            <div id="noResults" class="hidden text-center p-10 bg-white rounded-xl shadow-play mt-6">
                <p class="text-xl text-gray-500">
                    <i data-lucide="search-x" class="w-8 h-8 mx-auto mb-3 text-gray-400"></i>
                    <span id="noResultsText">ရှာဖွေမှုရလဒ် မတွေ့ရှိပါ။</span>
                </p>
                <p class="text-gray-500 text-sm mt-2">App အသစ်တစ်ခု တင်သွင်းရန် ကြိုးစားနိုင်ပါသည်။</p>
            </div>
        </main>
        
    </div>

    <footer id="bottomNav" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-2xl z-40">
        <div class="max-w-7xl mx-auto flex justify-around h-16">
            
            <button id="nav-All" class="nav-category-btn flex flex-col items-center justify-center flex-grow text-gray-500 transition duration-200" onclick="setCategoryFilter('All')">
                <i data-lucide="layout-grid" class="w-6 h-6 mb-0.5"></i>
                <span class="text-xs">အားလုံး</span>
            </button>
            
            <button id="nav-Games" class="nav-category-btn flex flex-col items-center justify-center flex-grow text-gray-500 transition duration-200" onclick="setCategoryFilter('Games')">
                <i data-lucide="gamepad" class="w-6 h-6 mb-0.5"></i>
                <span class="text-xs">ဂိမ်း</span>
            </button>

            <button id="nav-Utility" class="nav-category-btn flex flex-col items-center justify-center flex-grow text-gray-500 transition duration-200" onclick="setCategoryFilter('Utility')">
                <i data-lucide="wrench" class="w-6 h-6 mb-0.5"></i>
                <span class="text-xs">အသုံးဝင်မှု</span>
            </button>

            <button id="nav-Social" class="nav-category-btn flex flex-col items-center justify-center flex-grow text-gray-500 transition duration-200" onclick="setCategoryFilter('Social')">
                <i data-lucide="message-square" class="w-6 h-6 mb-0.5"></i>
                <span class="text-xs">လူမှုရေး</span>
            </button>
            
            <button id="nav-Entertainment" class="nav-category-btn flex flex-col items-center justify-center flex-grow text-gray-500 transition duration-200" onclick="setCategoryFilter('Entertainment')">
                <i data-lucide="smile" class="w-6 h-6 mb-0.5"></i>
                <span class="text-xs">ဖျော်ဖြေရေး</span>
            </button>
            
            <button id="nav-Profile" 
                        class="flex flex-col items-center justify-center flex-grow text-gray-500 transition duration-200 hover:text-active-blue" 
                        onclick="document.getElementById('profileModal').classList.remove('hidden'); window.updateProfileUI();"> 
                <i data-lucide="user" class="w-6 h-6 mb-0.5"></i>
                <span class="text-xs">Profile</span>
            </button>
            
        </div>
    </footer>


    <div id="profileModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="user-circle" class="w-6 h-6 mr-2 text-active-blue"></i>
                    သုံးစွဲသူ Profile
                </h2>
                <button id="closeProfileModalBtn" class="text-gray-400 hover:text-gray-600 transition" title="ပိတ်ရန်">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="text-center mb-6 p-4 bg-gray-50 rounded-lg">
                <div class="flex items-center justify-center w-16 h-16 rounded-full bg-play-green text-white font-bold text-xl mx-auto shadow-lg mb-3">
                    <span id="profileAvatarInitials">U</span>
                </div>
                <h3 id="profileDisplayName" class="text-xl font-bold text-gray-800"></h3>
                <p id="profileDisplayEmail" class="text-gray-500 text-sm"></p>
                <p class="text-xs text-gray-400 mt-2">Firebase ID: <span id="currentUserIdSpan">...</span></p>
            </div>

            <div id="loginContainer" class="space-y-4">
                <h3 class="text-md font-bold text-gray-700 mb-3 border-t pt-4">ဝင်ရောက်ခြင်း</h3>
                <button onclick="document.getElementById('userLoginModal').classList.remove('hidden'); profileModal.classList.add('hidden');"
                            class="w-full py-3 bg-active-blue text-white font-bold rounded-lg hover:bg-blue-700 active:bg-blue-800 transition duration-150 shadow-lg flex items-center justify-center space-x-3">
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                    <span>Name/Email ဖြင့် ဝင်ရောက်ရန်</span>
                </button>
            </div>

            <div id="logoutContainer" class="hidden space-y-4">
                
                <button onclick="document.getElementById('profileModal').classList.add('hidden'); window.setView('mine');"
                            class="w-full mb-4 py-3 border border-active-blue text-active-blue font-bold rounded-lg hover:bg-active-blue hover:text-white active:bg-blue-700 transition duration-150">
                    <i data-lucide="app-window" class="w-5 h-5 inline mr-2"></i>
                    ကျွန်ုပ်တင်ထားသော App များကိုကြည့်ရန်
                </button>

                <button onclick="window.userLogout()"
                            class="w-full py-3 bg-gray-300 text-gray-800 font-bold rounded-lg hover:bg-gray-400 active:bg-gray-500 transition duration-150 shadow-lg">
                    <i data-lucide="log-out" class="w-5 h-5 inline mr-2"></i>
                    ထွက်ရန် (Sign Out)
                </button>
            </div>
            
            <div class="mt-8 pt-4 border-t border-gray-200" id="adminPanel">
                <h3 class="text-lg font-bold text-red-600 mb-3 flex items-center">
                    <i data-lucide="shield" class="w-5 h-5 mr-2"></i>
                    Admin Control
                </h3>

                <div id="adminPanelStatus" class="p-3 bg-red-100 rounded-lg hidden">
                    <p class="text-sm font-semibold text-red-700">အုပ်ချုပ်သူအဖြစ် ဝင်ရောက်ထားပါသည်</p>
                    <p class="text-xs text-red-500">App အားလုံးကို ဖြုတ်/ပြင်ဆင်နိုင်ပါသည်။</p>
                    <button onclick="window.adminLogout()" class="mt-2 text-xs text-red-500 font-semibold hover:text-red-700">
                        Admin ထွက်ရန်
                    </button>
                </div>
                
                <div id="adminLoginSection" class="space-y-3">
                    <p class="text-sm text-gray-500">Admin ဝင်ခွင့်ရှိသူများသာ ဝင်ရောက်ပါ။</p>
                    <input type="text" id="adminNameInput" placeholder="Admin Name"
                           class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                    <input type="password" id="adminPassInput" placeholder="Password"
                           class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                    <button onclick="window.adminLogin()"
                            class="w-full py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition duration-150">
                        Admin ဝင်ရန်
                    </button>
                </div>
                
                <div id="adminLogoutSection" class="hidden">
                    </div>
                
            </div>
            </div>
    </div>
    
    <div id="userLoginModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 max-h-[90vh] overflow-y-auto modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="user-plus" class="w-6 h-6 mr-2 text-active-blue"></i>
                    App တင်သွင်းရန် ဝင်ရောက်ပါ
                </h2>
                <button id="closeUserLoginModalBtn" class="text-gray-400 hover:text-gray-600 transition" title="ပိတ်ရန်">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form id="userLoginForm" onsubmit="event.preventDefault(); window.userLogin()" class="space-y-4">
                <p class="text-sm text-gray-600">App တင်သွင်းသူအမည်နှင့် Email ကို ထည့်သွင်းပါ။</p>
                <div>
                    <label for="loginNameInput" class="block text-sm font-medium text-gray-700 mb-1">သင့်အမည် <span class="text-red-500">*</span></label>
                    <input type="text" id="loginNameInput" required placeholder="ဥပမာ: Wai Phyo"
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                </div>

                <div>
                    <label for="loginEmailInput" class="block text-sm font-medium text-gray-700 mb-1">သင့် Email လိပ်စာ <span class="text-red-500">*</span></label>
                    <input type="email" id="loginEmailInput" required placeholder="ဥပမာ: example@gmail.com"
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                    <p class="text-xs text-gray-500 mt-1">တင်သွင်းသူအဖြစ်မှတ်သားရန်အတွက်သာ အသုံးပြုပါသည်။</p>
                </div>
                
                <button type="submit" 
                            class="w-full py-3 bg-active-blue text-white font-bold rounded-lg hover:bg-blue-700 active:bg-blue-800 transition duration-150 shadow-lg mt-6">
                    <i data-lucide="check-circle" class="w-5 h-5 inline mr-2"></i>
                    ဝင်ရောက် အသုံးပြုမည်
                </button>
            </form>
        </div>
    </div>

    
    <div id="submitAppModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="cloud-upload" class="w-6 h-6 mr-2 text-play-green"></i>
                    App တင်သွင်းရန်
                </h2>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 transition" title="ပိတ်ရန်">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form id="appSubmissionForm" class="space-y-4">
                
                <div class="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <p class="text-xs font-semibold text-yellow-800 mb-2">တင်သွင်းသူ အချက်အလက်</p>
                    <input type="text" id="submitterNameInput" readonly class="w-full p-2 text-sm bg-white border border-gray-200 rounded-md mb-1 text-gray-600" title="သင့်အမည်။">
                    <input type="email" id="submitterEmailInput" readonly class="w-full p-2 text-sm bg-white border border-gray-200 rounded-md text-gray-600" title="သင့် Email။">
                </div>

                <div>
                    <label for="appName" class="block text-sm font-medium text-gray-700 mb-1">App နာမည် <span class="text-red-500">*</span></label>
                    <input type="text" id="appName" required placeholder="ဥပမာ: Burmese Keyboard Pro"
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                </div>

                <div>
                    <label for="appDescription" class="block text-sm font-medium text-gray-700 mb-1">ဖော်ပြချက် (အကျဉ်း) <span class="text-red-500">*</span></label>
                    <textarea id="appDescription" rows="3" required placeholder="App ရဲ့ အသုံးဝင်ပုံ၊ အင်္ဂါရပ်များကို ဖော်ပြပါ။"
                                     class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm resize-none"></textarea>
                </div>

                <div>
                    <label for="appCategory" class="block text-sm font-medium text-gray-700 mb-1">အမျိုးအစား <span class="text-red-500">*</span></label>
                    <select id="appCategory" required 
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm bg-white">
                        <option value="Games">ဂိမ်း (Games)</option>
                        <option value="Utility">အသုံးဝင်မှု (Utility)</option>
                        <option value="Social">လူမှုရေး (Social)</option>
                        <option value="Entertainment">ဖျော်ဖြေရေး (Entertainment)</option>
                    </select>
                </div>

                <div>
                    <label for="mediaFireLink" class="block text-sm font-medium text-gray-700 mb-1">ဒေါင်းလုတ်လင့်ခ် (Google Drive / MediaFire / Mega) <span class="text-red-500">*</span></label>
                    <input type="url" id="mediaFireLink" required placeholder="https://drive.google.com/..."
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                    <p class="text-xs text-gray-500 mt-1">လင့်ခ်ကို သေချာစွာ Public Share လုပ်ထားပါ။</p>
                </div>

                <div>
                    <label for="iconUrl" class="block text-sm font-medium text-gray-700 mb-1">App Icon ပုံလင့်ခ် (URL) <span class="text-red-500">*</span></label>
                    <input type="url" id="iconUrl" required placeholder="https://..."
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                    <p class="text-xs text-gray-500 mt-1">ကောင်းမွန်သော Icon တစ်ခုကို အသုံးပြုပါ။</p>
                </div>
                
                <button type="submit" 
                            class="w-full py-3 bg-play-green text-white font-bold rounded-lg hover:bg-active-blue active:bg-blue-700 transition duration-150 shadow-lg mt-6">
                    <i data-lucide="send" class="w-5 h-5 inline mr-2"></i>
                    App ကို တင်သွင်းရန်
                </button>
            </form>
        </div>
    </div>
    
    <div id="editAppModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="wrench" class="w-6 h-6 mr-2 text-yellow-600"></i>
                    Admin: App ပြင်ဆင်ရန်
                </h2>
                <button id="closeEditModalBtn" class="text-gray-400 hover:text-gray-600 transition" title="ပိတ်ရန်">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form id="editAppForm" class="space-y-4">
                <div>
                    <label for="editAppName" class="block text-sm font-medium text-gray-700 mb-1">App နာမည် <span class="text-red-500">*</span></label>
                    <input type="text" id="editAppName" required
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                </div>

                <div>
                    <label for="editAppDescription" class="block text-sm font-medium text-gray-700 mb-1">ဖော်ပြချက် (အကျဉ်း) <span class="text-red-500">*</span></label>
                    <textarea id="editAppDescription" rows="3" required
                                     class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm resize-none"></textarea>
                </div>

                <div>
                    <label for="editAppCategory" class="block text-sm font-medium text-gray-700 mb-1">အမျိုးအစား <span class="text-red-500">*</span></label>
                    <select id="editAppCategory" required
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm bg-white">
                        <option value="Games">ဂိမ်း (Games)</option>
                        <option value="Utility">အသုံးဝင်မှု (Utility)</option>
                        <option value="Social">လူမှုရေး (Social)</option>
                        <option value="Entertainment">ဖျော်ဖြေရေး (Entertainment)</option>
                    </select>
                </div>

                <div>
                    <label for="editMediaFireLink" class="block text-sm font-medium text-gray-700 mb-1">ဒေါင်းလုတ်လင့်ခ် <span class="text-red-500">*</span></label>
                    <input type="url" id="editMediaFireLink" required
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                </div>

                <div>
                    <label for="editIconUrl" class="block text-sm font-medium text-gray-700 mb-1">App Icon ပုံလင့်ခ် (URL) <span class="text-red-500">*</span></label>
                    <input type="url" id="editIconUrl" required
                                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-active-blue focus:border-active-blue shadow-sm">
                </div>

                <button type="submit"
                            class="w-full py-3 bg-yellow-600 text-white font-bold rounded-lg hover:bg-yellow-700 transition duration-150 shadow-lg mt-6">
                    <i data-lucide="check" class="w-5 h-5 inline mr-2"></i>
                    App အချက်အလက်များ သိမ်းဆည်းရန်
                </button>
            </form>
            
            <div class="mt-8 pt-4 border-t border-red-300">
                <h3 class="text-lg font-bold text-red-600 mb-3 flex items-center">
                    <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                    အပြီးအပိုင် ဖြုတ်ဖျက်ခြင်း
                </h3>
                <p class="text-sm text-gray-600 mb-3">App နာမည် <strong class="text-red-600" id="deleteAppNameToConfirm">...</strong> ကို စတိုးမှ အပြီးအပိုင် ဖျက်ပစ်လိုပါက အောက်ပါအတိုင်း ဆောင်ရွက်ပါ။</p>
                <div id="deleteConfirmationArea">
                    <label for="deleteConfirmationInput" class="block text-sm font-medium text-red-700 mb-1">ဖြုတ်ဖျက်ရန် App နာမည်ကို ရိုက်ထည့်ပါ</label>
                    <input type="text" id="deleteConfirmationInput" placeholder="App ၏နာမည်အတိုင်း ရိုက်ထည့်ပါ"
                                 class="w-full p-3 border border-red-400 rounded-lg focus:ring-red-500 focus:border-red-500 shadow-sm text-red-700">
                    
                    <button onclick="window.confirmAndDelete()"
                                 class="w-full py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition duration-150 shadow-lg mt-4">
                        <i data-lucide="trash-2" class="w-5 h-5 inline mr-2"></i>
                        App ကို ဖျက်ရန် အတည်ပြုပါ
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="toastNotification" class="opacity-0 hidden"></div>
    
</body>
</html>
